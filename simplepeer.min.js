(function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,t.SimplePeer=e()}})(function(){var t=Math.abs,n=Math.pow;return function(){function s(d,e,n){function t(l,r){if(!e[l]){if(!d[l]){var i="function"==typeof require&&require;if(!r&&i)return i(l,!0);if(o)return o(l,!0);var c=new Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var a=e[l]={exports:{}};d[l][0].call(a.exports,function(e){var o=d[l][1][e];return t(o||e)},a,a.exports,s,d,e,n)}return e[l].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)t(n[r]);return t}return s}()({1:[function(e,t,n){'use strict';function o(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var o=n===t?0:4-n%4;return[n,o]}function r(e,t,n){return 3*(t+n)/4-n}function s(e){var t,n,s=o(e),a=s[0],d=s[1],c=new u(r(e,a,d)),l=0,g=0<d?a-4:a;for(n=0;n<g;n+=4)t=p[e.charCodeAt(n)]<<18|p[e.charCodeAt(n+1)]<<12|p[e.charCodeAt(n+2)]<<6|p[e.charCodeAt(n+3)],c[l++]=255&t>>16,c[l++]=255&t>>8,c[l++]=255&t;return 2===d&&(t=p[e.charCodeAt(n)]<<2|p[e.charCodeAt(n+1)]>>4,c[l++]=255&t),1===d&&(t=p[e.charCodeAt(n)]<<10|p[e.charCodeAt(n+1)]<<4|p[e.charCodeAt(n+2)]>>2,c[l++]=255&t>>8,c[l++]=255&t),c}function a(e){return l[63&e>>18]+l[63&e>>12]+l[63&e>>6]+l[63&e]}function d(e,t,n){for(var o,r=[],s=t;s<n;s+=3)o=(16711680&e[s]<<16)+(65280&e[s+1]<<8)+(255&e[s+2]),r.push(a(o));return r.join("")}function c(e){for(var t,n=e.length,o=n%3,r=[],s=16383,a=0,c=n-o;a<c;a+=s)r.push(d(e,a,a+s>c?c:a+s));return 1===o?(t=e[n-1],r.push(l[t>>2]+l[63&t<<4]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],r.push(l[t>>10]+l[63&t>>4]+l[63&t<<2]+"=")),r.join("")}n.byteLength=function(e){var t=o(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=s,n.fromByteArray=c;for(var l=[],p=[],u="undefined"==typeof Uint8Array?Array:Uint8Array,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,m=g.length;f<m;++f)l[f]=g[f],p[g.charCodeAt(f)]=f;p[45]=62,p[95]=63},{}],2:[function(e,t,o){(function(){(function(){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */'use strict';var G=String.fromCharCode,H=Math.min;function t(e){if(2147483647<e)throw new RangeError("The value \""+e+"\" is invalid for option \"size\"");var t=new Uint8Array(e);return t.__proto__=r.prototype,t}function r(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError("The \"string\" argument must be of type string. Received type number");return d(e)}return i(e,t,n)}function i(e,t,n){if("string"==typeof e)return c(e,t);if(ArrayBuffer.isView(e))return l(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(V(e,ArrayBuffer)||e&&V(e.buffer,ArrayBuffer))return p(e,t,n);if("number"==typeof e)throw new TypeError("The \"value\" argument must not be of type number. Received type number");var o=e.valueOf&&e.valueOf();if(null!=o&&o!==e)return r.from(o,t,n);var i=u(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return r.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function s(e){if("number"!=typeof e)throw new TypeError("\"size\" argument must be of type number");else if(0>e)throw new RangeError("The value \""+e+"\" is invalid for option \"size\"")}function a(e,n,o){return s(e),0>=e?t(e):void 0===n?t(e):"string"==typeof o?t(e).fill(n,o):t(e).fill(n)}function d(e){return s(e),t(0>e?0:0|g(e))}function c(e,n){if(("string"!=typeof n||""===n)&&(n="utf8"),!r.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var o=0|f(e,n),i=t(o),s=i.write(e,n);return s!==o&&(i=i.slice(0,s)),i}function l(e){for(var n=0>e.length?0:0|g(e.length),o=t(n),r=0;r<n;r+=1)o[r]=255&e[r];return o}function p(e,t,n){if(0>t||e.byteLength<t)throw new RangeError("\"offset\" is outside of buffer bounds");if(e.byteLength<t+(n||0))throw new RangeError("\"length\" is outside of buffer bounds");var o;return o=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),o.__proto__=r.prototype,o}function u(e){if(r.isBuffer(e)){var n=0|g(e.length),o=t(n);return 0===o.length?o:(e.copy(o,0,0,n),o)}return void 0===e.length?"Buffer"===e.type&&Array.isArray(e.data)?l(e.data):void 0:"number"!=typeof e.length||Y(e.length)?t(0):l(e)}function g(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|e}function f(e,t){if(r.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||V(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError("The \"string\" argument must be one of type string, Buffer, or ArrayBuffer. Received type "+typeof e);var n=e.length,o=2<arguments.length&&!0===arguments[2];if(!o&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(i)return o?-1:q(e).length;t=(""+t).toLowerCase(),i=!0;}}function m(e,t,n){var o=!1;if((void 0===t||0>t)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),0>=n)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return v(this,t,n);case"latin1":case"binary":return F(this,t,n);case"base64":return w(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0;}}function h(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function _(e,t,n,o,i){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):2147483647<n?n=2147483647:-2147483648>n&&(n=-2147483648),n=+n,Y(n)&&(n=i?0:e.length-1),0>n&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(0>n)if(i)n=0;else return-1;if("string"==typeof t&&(t=r.from(t,o)),r.isBuffer(t))return 0===t.length?-1:y(e,t,n,o,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,o,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,o,r){function s(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,d=e.length,c=t.length;if(void 0!==o&&(o=(o+"").toLowerCase(),"ucs2"===o||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(2>e.length||2>t.length)return-1;a=2,d/=2,c/=2,n/=2}var l;if(r){var p=-1;for(l=n;l<d;l++)if(s(e,l)!==s(t,-1===p?0:l-p))-1!==p&&(l-=l-p),p=-1;else if(-1===p&&(p=l),l-p+1===c)return p*a}else for(n+c>d&&(n=d-c),l=n;0<=l;l--){for(var u=!0,g=0;g<c;g++)if(s(e,l+g)!==s(t,g)){u=!1;break}if(u)return l}return-1}function C(e,t,n,o){n=+n||0;var r=e.length-n;o?(o=+o,o>r&&(o=r)):o=r;var s=t.length;o>s/2&&(o=s/2);for(var a,d=0;d<o;++d){if(a=parseInt(t.substr(2*d,2),16),Y(a))return d;e[n+d]=a}return d}function b(e,t,n,o){return W(q(t,e.length-n),e,n,o)}function E(e,t,n,o){return W(M(t),e,n,o)}function R(e,t,n,o){return E(e,t,n,o)}function T(e,t,n,o){return W(z(t),e,n,o)}function A(e,t,n,o){return W(j(t,e.length-n),e,n,o)}function w(e,t,n){return 0===t&&n===e.length?K.fromByteArray(e):K.fromByteArray(e.slice(t,n))}function I(e,t,n){n=H(e.length,n);for(var o=[],r=t;r<n;){var s=e[r],a=null,d=239<s?4:223<s?3:191<s?2:1;if(r+d<=n){var c,l,p,u;1===d?128>s&&(a=s):2===d?(c=e[r+1],128==(192&c)&&(u=(31&s)<<6|63&c,127<u&&(a=u))):3===d?(c=e[r+1],l=e[r+2],128==(192&c)&&128==(192&l)&&(u=(15&s)<<12|(63&c)<<6|63&l,2047<u&&(55296>u||57343<u)&&(a=u))):4===d?(c=e[r+1],l=e[r+2],p=e[r+3],128==(192&c)&&128==(192&l)&&128==(192&p)&&(u=(15&s)<<18|(63&c)<<12|(63&l)<<6|63&p,65535<u&&1114112>u&&(a=u))):void 0}null===a?(a=65533,d=1):65535<a&&(a-=65536,o.push(55296|1023&a>>>10),a=56320|1023&a),o.push(a),r+=d}return S(o)}function S(e){var t=e.length;if(t<=4096)return G.apply(String,e);for(var n="",o=0;o<t;)n+=G.apply(String,e.slice(o,o+=4096));return n}function v(e,t,n){var o="";n=H(e.length,n);for(var r=t;r<n;++r)o+=G(127&e[r]);return o}function F(e,t,n){var o="";n=H(e.length,n);for(var r=t;r<n;++r)o+=G(e[r]);return o}function k(e,t,n){var o=e.length;(!t||0>t)&&(t=0),(!n||0>n||n>o)&&(n=o);for(var r="",s=t;s<n;++s)r+=U(e[s]);return r}function B(e,t,n){for(var o=e.slice(t,n),r="",s=0;s<o.length;s+=2)r+=G(o[s]+256*o[s+1]);return r}function N(e,t,n){if(0!=e%1||0>e)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,o,i,s){if(!r.isBuffer(e))throw new TypeError("\"buffer\" argument must be a Buffer instance");if(t>i||t<s)throw new RangeError("\"value\" argument is out of bounds");if(n+o>e.length)throw new RangeError("Index out of range")}function O(e,t,n,o){if(n+o>e.length)throw new RangeError("Index out of range");if(0>n)throw new RangeError("Index out of range")}function P(e,t,n,o,r){return t=+t,n>>>=0,r||O(e,t,n,4,34028234663852886e22,-34028234663852886e22),X.write(e,t,n,o,23,4),n+4}function x(e,t,n,o,r){return t=+t,n>>>=0,r||O(e,t,n,8,17976931348623157e292,-17976931348623157e292),X.write(e,t,n,o,52,8),n+8}function D(e){if(e=e.split("=")[0],e=e.trim().replace($,""),2>e.length)return"";for(;0!=e.length%4;)e+="=";return e}function U(e){return 16>e?"0"+e.toString(16):e.toString(16)}function q(e,t){t=t||1/0;for(var n,o=e.length,r=null,s=[],a=0;a<o;++a){if(n=e.charCodeAt(a),55295<n&&57344>n){if(!r){if(56319<n){-1<(t-=3)&&s.push(239,191,189);continue}else if(a+1===o){-1<(t-=3)&&s.push(239,191,189);continue}r=n;continue}if(56320>n){-1<(t-=3)&&s.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&-1<(t-=3)&&s.push(239,191,189);if(r=null,128>n){if(0>(t-=1))break;s.push(n)}else if(2048>n){if(0>(t-=2))break;s.push(192|n>>6,128|63&n)}else if(65536>n){if(0>(t-=3))break;s.push(224|n>>12,128|63&n>>6,128|63&n)}else if(1114112>n){if(0>(t-=4))break;s.push(240|n>>18,128|63&n>>12,128|63&n>>6,128|63&n)}else throw new Error("Invalid code point")}return s}function M(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function j(e,t){for(var n,o,r,s=[],a=0;a<e.length&&!(0>(t-=2));++a)n=e.charCodeAt(a),o=n>>8,r=n%256,s.push(r),s.push(o);return s}function z(e){return K.toByteArray(D(e))}function W(e,t,n,o){for(var r=0;r<o&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function V(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!==e}var K=e("base64-js"),X=e("ieee754");o.Buffer=r,o.SlowBuffer=function(e){return+e!=e&&(e=0),r.alloc(+e)},o.INSPECT_MAX_BYTES=50;o.kMaxLength=2147483647,r.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(t){return!1}}(),r.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(r.prototype,"parent",{enumerable:!0,get:function(){return r.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(r.prototype,"offset",{enumerable:!0,get:function(){return r.isBuffer(this)?this.byteOffset:void 0}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&r[Symbol.species]===r&&Object.defineProperty(r,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),r.poolSize=8192,r.from=function(e,t,n){return i(e,t,n)},r.prototype.__proto__=Uint8Array.prototype,r.__proto__=Uint8Array,r.alloc=function(e,t,n){return a(e,t,n)},r.allocUnsafe=function(e){return d(e)},r.allocUnsafeSlow=function(e){return d(e)},r.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==r.prototype},r.compare=function(e,t){if(V(e,Uint8Array)&&(e=r.from(e,e.offset,e.byteLength)),V(t,Uint8Array)&&(t=r.from(t,t.offset,t.byteLength)),!r.isBuffer(e)||!r.isBuffer(t))throw new TypeError("The \"buf1\", \"buf2\" arguments must be one of type Buffer or Uint8Array");if(e===t)return 0;for(var n=e.length,o=t.length,s=0,d=H(n,o);s<d;++s)if(e[s]!==t[s]){n=e[s],o=t[s];break}return n<o?-1:o<n?1:0},r.isEncoding=function(e){switch((e+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1;}},r.concat=function(e,t){if(!Array.isArray(e))throw new TypeError("\"list\" argument must be an Array of Buffers");if(0===e.length)return r.alloc(0);var n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=r.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){var a=e[n];if(V(a,Uint8Array)&&(a=r.from(a)),!r.isBuffer(a))throw new TypeError("\"list\" argument must be an Array of Buffers");a.copy(o,s),s+=a.length}return o},r.byteLength=f,r.prototype._isBuffer=!0,r.prototype.swap16=function(){var e=this.length;if(0!=e%2)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},r.prototype.swap32=function(){var e=this.length;if(0!=e%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},r.prototype.swap64=function(){var e=this.length;if(0!=e%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},r.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},r.prototype.toLocaleString=r.prototype.toString,r.prototype.equals=function(e){if(!r.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===r.compare(this,e)},r.prototype.inspect=function(){var e="",t=o.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},r.prototype.compare=function(e,t,n,o,s){if(V(e,Uint8Array)&&(e=r.from(e,e.offset,e.byteLength)),!r.isBuffer(e))throw new TypeError("The \"target\" argument must be one of type Buffer or Uint8Array. Received type "+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===s&&(s=this.length),0>t||n>e.length||0>o||s>this.length)throw new RangeError("out of range index");if(o>=s&&t>=n)return 0;if(o>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,o>>>=0,s>>>=0,this===e)return 0;for(var a=s-o,d=n-t,c=H(a,d),l=this.slice(o,s),p=e.slice(t,n),u=0;u<c;++u)if(l[u]!==p[u]){a=l[u],d=p[u];break}return a<d?-1:d<a?1:0},r.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},r.prototype.indexOf=function(e,t,n){return _(this,e,t,n,!0)},r.prototype.lastIndexOf=function(e,t,n){return _(this,e,t,n,!1)},r.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===o&&(o="utf8")):(o=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var r=this.length-t;if((void 0===n||n>r)&&(n=r),0<e.length&&(0>n||0>t)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return C(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return E(this,e,t,n);case"latin1":case"binary":return R(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0;}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};r.prototype.slice=function(e,t){var n=this.length;e=~~e,t=t===void 0?n:~~t,0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),t<e&&(t=e);var o=this.subarray(e,t);return o.__proto__=r.prototype,o},r.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var o=this[e],r=1,s=0;++s<t&&(r*=256);)o+=this[e+s]*r;return o},r.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var o=this[e+--t],r=1;0<t&&(r*=256);)o+=this[e+--t]*r;return o},r.prototype.readUInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),this[e]},r.prototype.readUInt16LE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]|this[e+1]<<8},r.prototype.readUInt16BE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]<<8|this[e+1]},r.prototype.readUInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},r.prototype.readUInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},r.prototype.readIntLE=function(e,t,o){e>>>=0,t>>>=0,o||N(e,t,this.length);for(var r=this[e],s=1,a=0;++a<t&&(s*=256);)r+=this[e+a]*s;return s*=128,r>=s&&(r-=n(2,8*t)),r},r.prototype.readIntBE=function(e,t,o){e>>>=0,t>>>=0,o||N(e,t,this.length);for(var r=t,s=1,a=this[e+--r];0<r&&(s*=256);)a+=this[e+--r]*s;return s*=128,a>=s&&(a-=n(2,8*t)),a},r.prototype.readInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},r.prototype.readInt16LE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt16BE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},r.prototype.readInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},r.prototype.readFloatLE=function(e,t){return e>>>=0,t||N(e,4,this.length),X.read(this,e,!0,23,4)},r.prototype.readFloatBE=function(e,t){return e>>>=0,t||N(e,4,this.length),X.read(this,e,!1,23,4)},r.prototype.readDoubleLE=function(e,t){return e>>>=0,t||N(e,8,this.length),X.read(this,e,!0,52,8)},r.prototype.readDoubleBE=function(e,t){return e>>>=0,t||N(e,8,this.length),X.read(this,e,!1,52,8)},r.prototype.writeUIntLE=function(e,t,o,r){if(e=+e,t>>>=0,o>>>=0,!r){var s=n(2,8*o)-1;L(this,e,t,o,s,0)}var a=1,d=0;for(this[t]=255&e;++d<o&&(a*=256);)this[t+d]=255&e/a;return t+o},r.prototype.writeUIntBE=function(e,t,o,r){if(e=+e,t>>>=0,o>>>=0,!r){var s=n(2,8*o)-1;L(this,e,t,o,s,0)}var a=o-1,d=1;for(this[t+a]=255&e;0<=--a&&(d*=256);)this[t+a]=255&e/d;return t+o},r.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,1,255,0),this[t]=255&e,t+1},r.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},r.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},r.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},r.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},r.prototype.writeIntLE=function(e,t,o,r){if(e=+e,t>>>=0,!r){var s=n(2,8*o-1);L(this,e,t,o,s-1,-s)}var a=0,d=1,c=0;for(this[t]=255&e;++a<o&&(d*=256);)0>e&&0===c&&0!==this[t+a-1]&&(c=1),this[t+a]=255&(e/d>>0)-c;return t+o},r.prototype.writeIntBE=function(e,t,o,r){if(e=+e,t>>>=0,!r){var s=n(2,8*o-1);L(this,e,t,o,s-1,-s)}var a=o-1,d=1,c=0;for(this[t+a]=255&e;0<=--a&&(d*=256);)0>e&&0===c&&0!==this[t+a+1]&&(c=1),this[t+a]=255&(e/d>>0)-c;return t+o},r.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,1,127,-128),0>e&&(e=255+e+1),this[t]=255&e,t+1},r.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},r.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},r.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},r.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},r.prototype.writeFloatLE=function(e,t,n){return P(this,e,t,!0,n)},r.prototype.writeFloatBE=function(e,t,n){return P(this,e,t,!1,n)},r.prototype.writeDoubleLE=function(e,t,n){return x(this,e,t,!0,n)},r.prototype.writeDoubleBE=function(e,t,n){return x(this,e,t,!1,n)},r.prototype.copy=function(e,t,n,o){if(!r.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),0<o&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(0>t)throw new RangeError("targetStart out of bounds");if(0>n||n>=this.length)throw new RangeError("Index out of range");if(0>o)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var s=o-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,o);else if(this===e&&n<t&&t<o)for(var a=s-1;0<=a;--a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,o),t);return s},r.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!r.isEncoding(o))throw new TypeError("Unknown encoding: "+o);if(1===e.length){var s=e.charCodeAt(0);("utf8"===o&&128>s||"latin1"===o)&&(e=s)}}else"number"==typeof e&&(e&=255);if(0>t||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=n===void 0?this.length:n>>>0,e||(e=0);var a;if("number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var d=r.isBuffer(e)?e:r.from(e,o),c=d.length;if(0===c)throw new TypeError("The value \""+e+"\" is invalid for argument \"value\"");for(a=0;a<n-t;++a)this[a+t]=d[a%c]}return this};var $=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:7}],3:[function(e,t,n){(function(o){(function(){function r(){let e;try{e=n.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof o&&"env"in o&&(e=o.env.DEBUG),e}n.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let o=0,r=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"===e||(o++,"%c"===e&&(r=o))}),e.splice(r,0,n)},n.save=function(e){try{e?n.storage.setItem("debug",e):n.storage.removeItem("debug")}catch(e){}},n.load=r,n.useColors=function(){return!!("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},n.storage=function(){try{return localStorage}catch(e){}}(),n.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.log=console.debug||console.log||(()=>{}),t.exports=e("./common")(n);const{formatters:i}=t.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,e("_process"))},{"./common":4,_process:9}],4:[function(e,n){n.exports=function(n){function o(e){function t(...e){if(!t.enabled)return;const r=t,i=+new Date,s=i-(n||i);r.diff=s,r.prev=n,r.curr=i,n=i,e[0]=o.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,n)=>{if("%%"===t)return"%";a++;const i=o.formatters[n];if("function"==typeof i){const n=e[a];t=i.call(r,n),e.splice(a,1),a--}return t}),o.formatArgs.call(r,e);const d=r.log||o.log;d.apply(r,e)}let n,i=null;return t.namespace=e,t.useColors=o.useColors(),t.color=o.selectColor(e),t.extend=r,t.destroy=o.destroy,Object.defineProperty(t,"enabled",{enumerable:!0,configurable:!1,get:()=>null===i?o.enabled(e):i,set:e=>{i=e}}),"function"==typeof o.init&&o.init(t),t}function r(e,t){const n=o(this.namespace+("undefined"==typeof t?":":t)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return o.debug=o,o.default=o,o.coerce=function(e){return e instanceof Error?e.stack||e.message:e},o.disable=function(){const e=[...o.names.map(i),...o.skips.map(i).map(e=>"-"+e)].join(",");return o.enable(""),e},o.enable=function(e){o.save(e),o.names=[],o.skips=[];let t;const n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&(e=n[t].replace(/\*/g,".*?"),"-"===e[0]?o.skips.push(new RegExp("^"+e.substr(1)+"$")):o.names.push(new RegExp("^"+e+"$")))},o.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=o.skips.length;t<n;t++)if(o.skips[t].test(e))return!1;for(t=0,n=o.names.length;t<n;t++)if(o.names[t].test(e))return!0;return!1},o.humanize=e("ms"),o.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(n).forEach(e=>{o[e]=n[e]}),o.names=[],o.skips=[],o.formatters={},o.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return o.colors[t(n)%o.colors.length]},o.enable(o.load()),o}},{ms:8}],5:[function(e,t){'use strict';function n(e,t){for(const n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}t.exports=function(e,t,o){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");o||(o={}),"object"==typeof t&&(o=t,t=void 0),null!=t&&(o.code=t);try{return n(e,o)}catch(t){o.message=e.message,o.stack=e.stack;const r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(e)),n(new r,o)}}},{}],6:[function(e,t){t.exports=function(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},{}],7:[function(e,o,r){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */r.read=function(t,o,r,a,c){var l,p,u=8*c-a-1,g=(1<<u)-1,f=g>>1,h=-7,_=r?c-1:0,y=r?-1:1,d=t[o+_];for(_+=y,l=d&(1<<-h)-1,d>>=-h,h+=u;0<h;l=256*l+t[o+_],_+=y,h-=8);for(p=l&(1<<-h)-1,l>>=-h,h+=a;0<h;p=256*p+t[o+_],_+=y,h-=8);if(0===l)l=1-f;else{if(l===g)return p?NaN:(d?-1:1)*(1/0);p+=n(2,a),l-=f}return(d?-1:1)*p*n(2,l-a)},r.write=function(o,r,a,l,p,u){var _,y,C,g=Math.floor,f=Math.LN2,h=Math.log,b=8*u-p-1,E=(1<<b)-1,R=E>>1,T=23===p?n(2,-24)-n(2,-77):0,A=l?0:u-1,w=l?1:-1,d=0>r||0===r&&0>1/r?1:0;for(r=t(r),isNaN(r)||r===1/0?(y=isNaN(r)?1:0,_=E):(_=g(h(r)/f),1>r*(C=n(2,-_))&&(_--,C*=2),r+=1<=_+R?T/C:T*n(2,1-R),2<=r*C&&(_++,C/=2),_+R>=E?(y=0,_=E):1<=_+R?(y=(r*C-1)*n(2,p),_+=R):(y=r*n(2,R-1)*n(2,p),_=0));8<=p;o[a+A]=255&y,A+=w,y/=256,p-=8);for(_=_<<p|y,b+=p;0<b;o[a+A]=255&_,A+=w,_/=256,b-=8);o[a+A-w]|=128*d}},{}],8:[function(e,n){var a=Math.round;function o(e){if(e+="",!(100<e.length)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var o=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();return"years"===n||"year"===n||"yrs"===n||"yr"===n||"y"===n?31557600000*o:"weeks"===n||"week"===n||"w"===n?604800000*o:"days"===n||"day"===n||"d"===n?86400000*o:"hours"===n||"hour"===n||"hrs"===n||"hr"===n||"h"===n?3600000*o:"minutes"===n||"minute"===n||"mins"===n||"min"===n||"m"===n?60000*o:"seconds"===n||"second"===n||"secs"===n||"sec"===n||"s"===n?1000*o:"milliseconds"===n||"millisecond"===n||"msecs"===n||"msec"===n||"ms"===n?o:void 0}}}function r(e){var n=t(e);return 86400000<=n?a(e/86400000)+"d":3600000<=n?a(e/3600000)+"h":60000<=n?a(e/60000)+"m":1000<=n?a(e/1000)+"s":e+"ms"}function i(e){var n=t(e);return 86400000<=n?s(e,n,86400000,"day"):3600000<=n?s(e,n,3600000,"hour"):60000<=n?s(e,n,60000,"minute"):1000<=n?s(e,n,1000,"second"):e+" ms"}function s(e,t,o,n){return a(e/o)+" "+n+(t>=1.5*o?"s":"")}var c=24*(60*60000);n.exports=function(e,t){t=t||{};var n=typeof e;if("string"==n&&0<e.length)return o(e);if("number"===n&&isFinite(e))return t.long?i(e):r(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],9:[function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(t){if(l===setTimeout)return setTimeout(t,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(n){try{return l.call(null,t,0)}catch(n){return l.call(this,t,0)}}}function i(t){if(p===clearTimeout)return clearTimeout(t);if((p===o||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(n){try{return p.call(null,t)}catch(n){return p.call(this,t)}}}function s(){m&&g&&(m=!1,g.length?f=g.concat(f):h=-1,f.length&&a())}function a(){if(!m){var e=r(s);m=!0;for(var t=f.length;t;){for(g=f,f=[];++h<t;)g&&g[h].run();h=-1,t=f.length}g=null,m=!1,i(e)}}function d(e,t){this.fun=e,this.array=t}function c(){}var l,p,u=t.exports={};(function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(t){l=n}try{p="function"==typeof clearTimeout?clearTimeout:o}catch(t){p=o}})();var g,f=[],m=!1,h=-1;u.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new d(e,t)),1!==f.length||m||r(a)},d.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=c,u.addListener=c,u.once=c,u.off=c,u.removeListener=c,u.removeAllListeners=c,u.emit=c,u.prependListener=c,u.prependOnceListener=c,u.listeners=function(){return[]},u.binding=function(){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],10:[function(e,t){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let n;t.exports="function"==typeof queueMicrotask?queueMicrotask.bind(globalThis):e=>(n||(n=Promise.resolve())).then(e).catch(e=>setTimeout(()=>{throw e},0))},{}],11:[function(e,t){(function(n,o){(function(){'use strict';var r=e("safe-buffer").Buffer,i=o.crypto||o.msCrypto;t.exports=i&&i.getRandomValues?function(e,t){if(e>4294967295)throw new RangeError("requested too many random bytes");var o=r.allocUnsafe(e);if(0<e)if(65536<e)for(var s=0;s<e;s+=65536)i.getRandomValues(o.slice(s,s+65536));else i.getRandomValues(o);return"function"==typeof t?n.nextTick(function(){t(null,o)}):o}:function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this)}).call(this,e("_process"),"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{_process:9,"safe-buffer":12}],12:[function(e,t,n){function o(e,t){for(var n in e)t[n]=e[n]}function r(e,t,n){return s(e,t,n)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var i=e("buffer"),s=i.Buffer;s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?t.exports=i:(o(i,n),n.Buffer=r),r.prototype=Object.create(s.prototype),o(s,r),r.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return s(e,t,n)},r.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var o=s(e);return void 0===t?o.fill(0):"string"==typeof n?o.fill(t,n):o.fill(t),o},r.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s(e)},r.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},{buffer:2}],"/":[function(e,t){function n(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}function o(e){console.warn(e)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const r=e("debug")("simple-peer"),i=e("get-browser-rtc"),s=e("randombytes"),a=e("queue-microtask"),d=e("err-code");class c{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),this._id=s(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||s(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||c.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},c.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(e=>e),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=void 0===e.trickle||e.trickle,this.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,this.iceCompleteTimeout=e.iceCompleteTimeout||5000,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:i(),!this._wrtc)if("undefined"==typeof window)throw d(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT");else throw d(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._listeners=[],this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._remoteTracks=[],this._remoteStreams=[],this._cb=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){return void a(()=>this.destroy(d(e,"ERR_PC_CONSTRUCTOR")))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)},this._debug("initial negotiation"),this._needsNegotiation()}connection(){return this._pc}on(e,t){const n=this._listeners[e];n?n.push(t):this._listeners[e]=[t]}off(e,t){const n=this._listeners[e];if(n){const o=n.filter(e=>e!==t);o.length?this._listeners[e]=o:delete this._listeners[e]}}once(e,t){const n=(o,r,i,s)=>{this.off(e,n),t(o,r,i,s)};this.on(e,n)}emit(){const e=arguments[0],t=Array.prototype.slice.call(arguments).slice(1),n=this._listeners[e];console.log(">>>>>> emit",e,"args",t,"listeners",n),n&&n.forEach(e=>e.apply(e,t))}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(this.destroyed)throw d(new Error("cannot signal after peer is destroyed"),"ERR_SIGNALING");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()",e),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(e=>{this._addIceCandidate(e)}),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())}).catch(e=>{this.destroy(d(e,"ERR_SET_REMOTE_DESCRIPTION"))}),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(d(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(e=>{!t.address||t.address.endsWith(".local")?o("Ignoring unsupported ICE candidate."):this.destroy(d(e,"ERR_ADD_ICE_CANDIDATE"))})}addTransceiver(e,t){if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(d(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}addStream(e){this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}addTrack(e,t){this._debug("addTrack()");const n=this._senderMap.get(e)||new Map;let o=n.get(t);if(!o)o=this._pc.addTrack(e,t),n.set(t,o),this._senderMap.set(e,n),this._needsNegotiation();else if(o.removed)throw d(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED");else throw d(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,n){this._debug("replaceTrack()");const o=this._senderMap.get(e),r=o?o.get(n):null;if(!r)throw d(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,o),null==r.replaceTrack?this.destroy(d(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):r.replaceTrack(t)}removeTrack(e,t){this._debug("removeSender()");const n=this._senderMap.get(e),o=n?n.get(t):null;if(!o)throw d(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{o.removed=!0,this._pc.removeTrack(o)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(o):this.destroy(d(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,a(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}destroy(e){this._destroy(e,()=>{})}_destroy(e,t){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),a(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,this._cb=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}))}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=n(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(!this.destroyed){const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp})}};this._pc.setLocalDescription(e).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))}).catch(e=>{this.destroy(d(e,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(e=>{this.destroy(d(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{e.mid||!e.sender.track||e.requested||(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=n(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(!this.destroyed){const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(e).then(()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))}).catch(e=>{this.destroy(d(e,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(e=>{this.destroy(d(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||(this._debug("connectionStateChange (connection: %s)",this._pc.connectionState),"failed"===this._pc.connectionState?this.destroy(d(new Error("Connection failed."),"ERR_CONNECTION_FAILURE")):("disconnected"===this._pc.connectionState||"closed"===this._pc.connectionState)&&this.destroy())}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),("connected"===e||"completed"===e)&&(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(d(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(d(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED")),"disconnected"===e&&this.destroy()}getStats(e){const t=e=>("[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach(t=>{Object.assign(e,t)}),e);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then(n=>{const o=[];n.forEach(e=>{o.push(t(e))}),e(null,o)},t=>e(t)):0<this._pc.getStats.length?this._pc.getStats(n=>{if(this.destroyed)return;const o=[];n.result().forEach(e=>{const n={};e.names().forEach(t=>{n[t]=e.stat(t)}),n.id=e.id,n.type=e.type,n.timestamp=e.timestamp,o.push(t(n))}),e(null,o)},t=>e(t)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((t,n)=>{if(this.destroyed)return;t&&(n=[]);const o={},r={},i={};let s=!1;n.forEach(e=>{("remotecandidate"===e.type||"remote-candidate"===e.type)&&(o[e.id]=e),("localcandidate"===e.type||"local-candidate"===e.type)&&(r[e.id]=e),("candidatepair"===e.type||"candidate-pair"===e.type)&&(i[e.id]=e)});const a=e=>{s=!0;let t=r[e.localCandidateId];t&&(t.ip||t.address)?(this.localAddress=t.ip||t.address,this.localPort=+t.port):t&&t.ipAddress?(this.localAddress=t.ipAddress,this.localPort=+t.portNumber):"string"==typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),this.localAddress=t[0],this.localPort=+t[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let n=o[e.remoteCandidateId];n&&(n.ip||n.address)?(this.remoteAddress=n.ip||n.address,this.remotePort=+n.port):n&&n.ipAddress?(this.remoteAddress=n.ipAddress,this.remotePort=+n.portNumber):"string"==typeof e.googRemoteAddress&&(n=e.googRemoteAddress.split(":"),this.remoteAddress=n[0],this.remotePort=+n[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};return(n.forEach(e=>{"transport"===e.type&&e.selectedCandidatePairId&&a(i[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&a(e)}),!s&&(!Object.keys(i).length||Object.keys(r).length))?void setTimeout(e,100):void(this._connecting=!1,this._connected=!0,this._debug("connect"),this.emit("connect"))})};e()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some(e=>e.id===t.id)||(this._remoteStreams.push(t),a(()=>{this._debug("on stream"),this.emit("stream",t)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],r.apply(null,e)}}c.WEBRTC_SUPPORT=!!i(),c.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},c.channelConfig={},t.exports=c},{debug:3,"err-code":5,"get-browser-rtc":6,"queue-microtask":10,randombytes:11}]},{},[])("/")});